<!DOCTYPE html><html><head><meta charSet="utf-8" class="next-head"/><link rel="preload" href="/_next/static/AM14GnVzd4TuMXCwbW_S3/pages/guides/materializations.js" as="script"/><link rel="preload" href="/_next/static/AM14GnVzd4TuMXCwbW_S3/pages/_app.js" as="script"/><link rel="preload" href="/_next/static/AM14GnVzd4TuMXCwbW_S3/pages/_error.js" as="script"/><link rel="preload" href="/_next/static/runtime/webpack-42652fa8b82c329c0559.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.f702609f3499fbcc7736.js" as="script"/><link rel="preload" href="/_next/static/runtime/main-800a4adf7c4f804bfe9c.js" as="script"/><link rel="stylesheet" href="/static/css/blueprint.css"/><link rel="stylesheet" href="/static/css/normalize.css"/><link rel="stylesheet" href="/static/css/highlight.css"/><link rel="stylesheet" href="/static/css/core.css"/><link rel="shortcut icon" href="/static/images/logo.png" type="image/png"/><script type="text/javascript" src="/static/js/inline.js"></script></head><body style="margin:0px;background-color:#f8f9fa;font-family:Lato, Roboto, &quot;Helvetica Neue&quot;, Arial, sans-serif;color:#495057;font-size:1rem;font-weight:400;line-height:1.5"><div class="bp3-navbar bp3-fixed-top hideInline" title="Dataform"><div class="bp3-navbar-group bp3-align-left"><img src="/static/images/logo_with_text.svg" style="height:100%;opacity:0.9"/></div><div class="bp3-navbar-group bp3-align-right"><a style="height:100%;padding:10px" href="https://github.com/tada-science/dataform"><img style="filter:invert(100%);height:100%" src="/static/images/github_logo.png"/></a></div></div><div style="height:50px" class="hideInline"></div><div style="padding:20px;width:100%;max-width:960px;margin:auto"><div id="__next"><div style="display:flex;flex-direction:row"><div style="width:280px;min-width:280px;padding:10px" class="hideInline"><div><h3>Guides</h3><ul style="background-color:transparent" class="bp3-menu"><li class=""><a href="/guides/assertions" class="bp3-menu-item bp3-popover-dismiss"><div class="bp3-text-overflow-ellipsis bp3-fill">Assertions</div></a></li><li class=""><a href="/guides/configuration" class="bp3-menu-item bp3-popover-dismiss"><div class="bp3-text-overflow-ellipsis bp3-fill">Configuration</div></a></li><li class=""><a href="/guides/core-concepts" class="bp3-menu-item bp3-popover-dismiss"><div class="bp3-text-overflow-ellipsis bp3-fill">Core concepts</div></a></li><li class=""><a href="/guides/includes" class="bp3-menu-item bp3-popover-dismiss"><div class="bp3-text-overflow-ellipsis bp3-fill">Includes</div></a></li><li class=""><a href="/guides/js-api" class="bp3-menu-item bp3-popover-dismiss"><div class="bp3-text-overflow-ellipsis bp3-fill">JS API</div></a></li><li class=""><a href="/guides/operations" class="bp3-menu-item bp3-popover-dismiss"><div class="bp3-text-overflow-ellipsis bp3-fill">Operations</div></a></li><li class=""><a href="/guides/materializations" class="bp3-menu-item bp3-popover-dismiss"><div class="bp3-text-overflow-ellipsis bp3-fill">Materializations</div></a></li><li class=""><a href="/guides/command-line-interface" class="bp3-menu-item bp3-popover-dismiss"><div class="bp3-text-overflow-ellipsis bp3-fill">Command line interface</div></a></li></ul><h3>Reference</h3><ul style="background-color:transparent" class="bp3-menu"><li class=""><a href="/reference/assertions" class="bp3-menu-item bp3-popover-dismiss"><div class="bp3-text-overflow-ellipsis bp3-fill">Assertions</div></a></li><li class=""><a href="/reference/contextable" class="bp3-menu-item bp3-popover-dismiss"><div class="bp3-text-overflow-ellipsis bp3-fill">Contextable&lt;&gt; Class</div></a></li><li class=""><a href="/reference/dataform-json" class="bp3-menu-item bp3-popover-dismiss"><div class="bp3-text-overflow-ellipsis bp3-fill">dataform.json</div></a></li><li class=""><a href="/reference/js-api" class="bp3-menu-item bp3-popover-dismiss"><div class="bp3-text-overflow-ellipsis bp3-fill">JS API</div></a></li><li class=""><a href="/reference/materialization-config" class="bp3-menu-item bp3-popover-dismiss"><div class="bp3-text-overflow-ellipsis bp3-fill">MaterializationConfig Class</div></a></li><li class=""><a href="/reference/operations" class="bp3-menu-item bp3-popover-dismiss"><div class="bp3-text-overflow-ellipsis bp3-fill">Operations</div></a></li><li class=""><a href="/reference/materializations" class="bp3-menu-item bp3-popover-dismiss"><div class="bp3-text-overflow-ellipsis bp3-fill">Materializations</div></a></li></ul></div></div><div style="flex-grow:1"><h1>Materializations</h1><div><p>A materialization defines a table, or view that will be created in your data warehouse.</p><p>To define a new materialization, create a <code>.sql</code> file in the <code>definitions</code> directory. The name of the file will be the name of the table created in your data warehouse.</p><p>For example, the file <code>definitions/example.sql</code> with the contents:</p><pre><code class="hljs language-js" metaString="">select <span class="hljs-number">1</span> <span class="hljs-keyword">as</span> test</code></pre><p>Will create a <code>view</code> called <code>example</code> in the default dataform schema defined in the <a href="/configuration/#dataform.json"><code>dataform.json</code></a> file.</p><p>There are many configuration options that can be applied to a materialization, for a full list see the <a href="/reference/materializations">materializations reference</a>.</p><h2>Tables</h2><p>By default, materializations are created as views in your warehouse. To create a copy of the query result as table, you can use the <code>type</code> method to change the materialization type to <code>&quot;table&quot;</code>.</p><pre><code class="hljs language-sql" metaString=""><span class="hljs-comment">--js type(&quot;table&quot;);</span>
<span class="hljs-keyword">select</span> <span class="hljs-number">1</span> <span class="hljs-keyword">as</span> <span class="hljs-keyword">test</span></code></pre><h2>Incremental tables</h2><p>Incremental tables allow you build a table incrementally, by only inserting data that has not yet been processed.</p><p>In order to define an incremental table we must set the <code>type</code> of the query to <code>&quot;incremental&quot;</code>, and provide a where clause.</p><p>For example, if you have a timestamp field in a source table called <code>ts</code>, then you can provide a where statement that means only rows that are newer than the latest value value of <code>ts</code> in our output table. The <code>where</code> function should be used inline as part of a query.</p><p><div class="bp3-callout bp3-icon-info-sign bp3-intent-warning" markdown="1">When using incremental tables, you must describe all the columns in the table, so that the correct insert statements can be generated.</div></p><pre><code class="hljs language-sql" metaString=""><span class="hljs-comment">/*js
type(&quot;incremental&quot;);
where(`ts &gt; (select max(ts) from ${self()}`);
descriptor(&quot;ts&quot;, &quot;a&quot;, &quot;b&quot;);
*/</span>
<span class="hljs-keyword">select</span> ts, a, b <span class="hljs-keyword">from</span> sourcetable</code></pre><p>Incremental tables automatically produce the necessary <code>create table</code> and <code>insert</code> statements.</p><p>For the above example, if the table does not exist the the following statement will be run:</p><pre><code class="hljs language-sql" metaString=""><span class="hljs-keyword">create</span> <span class="hljs-keyword">or</span> <span class="hljs-keyword">replace</span> <span class="hljs-keyword">table</span> dataform.incrementalexample <span class="hljs-keyword">as</span>
  <span class="hljs-keyword">select</span> ts, a, b
  <span class="hljs-keyword">from</span> sourcetable</code></pre><p>Subsequent runs will then run the following statement:</p><pre><code class="hljs language-sql" metaString=""><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> dataform.incrementalexample (ts, a, b)
  <span class="hljs-keyword">select</span> ts, a, b
  <span class="hljs-keyword">from</span> sourcetable
  <span class="hljs-keyword">where</span> ts &gt; (<span class="hljs-keyword">select</span> <span class="hljs-keyword">max</span>(ts) <span class="hljs-keyword">from</span> dataform.incrementaltable)</code></pre><p>It&#x27;s important to note that incremental tables MUST specifically list selected fields, so that the insert statement can be automatically generated.</p><p>The following would not work:</p><pre><code class="hljs language-sql" metaString=""><span class="hljs-comment">--js type(&quot;incremental&quot;);</span>
<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> sourcetable</code></pre><h2>Pre operations</h2><p>You can execute one or more statements before a table is materialized using the <a href="/built-in-functions#preOps"><code>preOps()</code></a> built-in:</p><pre><code class="hljs language-js" metaString=""><span class="hljs-comment">/*js
preOps([
  &quot;run this before&quot;,
  &quot;then run this before&quot;
])
*/</span>
select <span class="hljs-number">1</span> <span class="hljs-keyword">as</span> test</code></pre><h2>Post operations</h2><p>You can execute one or more statements after a table is materialized using the <a href="/built-in-functions#postOps"><code>postOps()</code></a> built-in:</p><pre><code class="hljs language-js" metaString=""><span class="hljs-comment">/*js
postOps([
  &quot;run this after&quot;,
  &quot;then run this after&quot;
])
*/</span>
select <span class="hljs-number">1</span> <span class="hljs-keyword">as</span> test</code></pre></div></div></div></div><script>__NEXT_DATA__ = {"props":{"pageProps":{}},"page":"/guides/materializations","query":{},"buildId":"AM14GnVzd4TuMXCwbW_S3","nextExport":true};__NEXT_LOADED_PAGES__=[];__NEXT_REGISTER_PAGE=function(r,f){__NEXT_LOADED_PAGES__.push([r, f])}</script><script async="" id="__NEXT_PAGE__/guides/materializations" src="/_next/static/AM14GnVzd4TuMXCwbW_S3/pages/guides/materializations.js"></script><script async="" id="__NEXT_PAGE__/_app" src="/_next/static/AM14GnVzd4TuMXCwbW_S3/pages/_app.js"></script><script async="" id="__NEXT_PAGE__/_error" src="/_next/static/AM14GnVzd4TuMXCwbW_S3/pages/_error.js"></script><script src="/_next/static/runtime/webpack-42652fa8b82c329c0559.js" async=""></script><script src="/_next/static/chunks/commons.f702609f3499fbcc7736.js" async=""></script><script src="/_next/static/runtime/main-800a4adf7c4f804bfe9c.js" async=""></script></div></body></html>